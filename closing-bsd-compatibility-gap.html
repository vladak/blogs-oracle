<html><body>
<head>
            <title>Closing BSD compatibility gap | Oracle Czech techie's adventures Blog</title>
<meta name="publish_date" content="2007-08-23 00:15:33">
</head>
                                                                    <p>I do not get to meet customers very often but I clearly remember the last time where I participated in a pseudo-technical session with a new customer. The engineers were keen on learning details about all features which make Solaris outstanding but they were also bewildered by the lack of common functions such as <tt>daemon()</tt> (see <a href="http://bugs.opensolaris.org/view_bug.do?bug_id=4471189">CR 4471189</a>). Yes, there is a number of private implementations in <a href="http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/lib/libresolv2/common/bsd/daemon.c#59">various</a> <a href="http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/cmd/cmd-inet/usr.lib/mdnsd/mDNSUNP.c">places</a> in <a href="http://www.opensolaris.org/os/community/on/">ONNV</a>, however this is not very useful. Until recently, this was also the case of err/warn function family.</p><p>With the putback of <a href="http://bugs.opensolaris.org/view_bug.do?bug_id=6495220">CR 6495220</a> there are now the following functions <a href="http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/lib/libc/port/gen/err.c">living in libc</a>:</p><pre>  void err(int, const char &#92;*, ...);<br/>  void verr(int, const char &#92;*, va_list);<br/>  void errx(int, const char &#92;*, ...);<br/>  void verrx(int, const char &#92;*, va_list);<br/>  void warn(const char &#92;*, ...);<br/>  void vwarn(const char &#92;*, va_list);<br/>  void warnx(const char &#92;*, ...);<br/>  void vwarnx(const char &#92;*, va_list);</pre><p>These functions were present in BSD systems for a long time (they've been in FreeBSD <a href="http://moduli.net/grok/history/freebsd/src/lib/libc/gen/err.c">since 1994</a>).<br/>The configure scripts of various pieces of software contain checks for presence and functionality of the err/warn functions in libc (and setting the <tt>HAVE_ERR_H</tt> define). For Solaris, those checks have now become enabled too.</p><p>The err(3C) man page covering these functions will be delivered in the same build as the changes, that is build 72.</p><p>The change is covered by PSARC 2006/662 <a href="http://www.opensolaris.org/os/community/arc/arc-faq/arc-review-overview/">architectural review</a> and the stability level for all the functions is <a href="http://www.opensolaris.org/os/community/arc/policies/interface-taxonomy/"><i>Committed</i></a><br/>(see <a href="http://www.opensolaris.org/os/community/arc/">Architecture Process and Tools</a> for more details on how this works).<br/>Unfortunately, the case is still closed. Hopefully it will be <a href="http://www.opensolaris.org/os/community/arc/arc-faq/arc-publish-historical-checklist/">opened</a> soon.<br/><br/><br/>Update 09-28-2007: the <a href="http://www.opensolaris.org/os/community/arc/caselog/2006/662/">PSARC/2006/662 case is now open</a>, including <a href="http://www.opensolaris.org/os/community/arc/caselog/2006/662/onepager/">onepager document</a> and <a href="http://www.opensolaris.org/os/community/arc/caselog/2006/662/mail">e-mail discussion</a>. Thanks to <a href="http://blogs.sun.com/plocher/">John Plocher</a>, <a href="http://blogs.sun.com/avalon/">Darren Reed</a> and <a href="http://blogs.sun.com/sommerfeld/">Bill Sommerfeld</a>.</p><p>As I prompted in the <a href="http://www.opensolaris.org/os/community/on/flag-days/pages/2007082002/">err/warn Heads-up</a> there is now time to stop creating new private implementations and to look at purging duplicates (there are <a href="http://src.opensolaris.org/source/search?q=&defs=warn&refs=&path=&hist=&project=%2Fonnv">many</a> of them, however not all can be gotten rid of in favour of err/warn from libc).</p><p>I will write about how to get code into libc in general from a more detailed perspective <a href="http://blogs.sun.com/vlad/entry/getting_code_into_libc">next time</a>.</p><p>However, this does not mean there is nothing left to do in this area. Specifically, FreeBSD's <a href="http://www.freebsd.org/cgi/man.cgi?query=err&apropos=0&sektion=0&manpath=FreeBSD+6.2-RELEASE&format=html">err(3)</a><br/>contains functions <tt>err_set_exit()</tt>, <tt>err_set_file()</tt> and <tt>errc()</tt>, <tt>warnc()</tt>, <tt>verrc()</tt> and <tt>vwarnc()</tt>. These functions could be ported over too. Also, there is <tt>__progname</tt> or <a href="http://www.freebsd.org/cgi/man.cgi?query=getprogname&apropos=0&sektion=0&manpath=FreeBSD+6.2-RELEASE&format=html">getprogname(3)</a>. Moreover, careful (code) reader has realized that <a href="http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/lib/libc/port/gen/err.c">err.c</a> contains private implementations of functions with <tt>fp</tt> suffix. This function (sub)family could be made <i>Committed</i> too. So, there is still lot of work which could be done. Anyone is free to work on any of these. (see <a href="ttp://blogs.sun.com/jkini/">Jayakara Kini's</a> blog entry on <a href="http://blogs.sun.com/jkini/entry/contributing_to_opensolaris">how to become OpenSolaris contributor</a> if you're not already)</p>
</body></html>
