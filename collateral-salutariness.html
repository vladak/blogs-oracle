<html><body>
<head>
            <title>Collateral salutariness | Oracle Czech techie's adventures Blog</title>
<meta name="publish_date" content="2009-04-07 07:02:21">
</head>
                                                                    <p>Each build of (Open)Solaris is tested with a variety of test suites on variety of platforms<br/>and I wanted nc test suite to participate in these runs.<br/><br/><br/>Eoin Hughes from PIT team (which runs those tests) was kind enough to workaround couple of bugs (which are fixed now)<br/>in the test suite so it can be run in PIT environment. Later on, I got a report from Eoin<br/>that as a result of <a href="http://opensolaris.org/os/community/networking/tests/nc/">nc test suite</a> run <br/>CR 6793191 (<i>watchmalloc triggers system panic on sockfs copyin</i>) was caught. <br/>This bug is manifested by a panic:</p><pre>Panic message (this particular panic is on a DomU, although this happens across the board):<br/>panic[cpu0]/thread=ffffff0150ce1540: copyin_noerr: argument not in kernel address space<br/>ffffff000416dcf0 unix:bcopy_ck_size+102 ()<br/>ffffff000416ddb0 genunix:watch_xcopyin+151 ()<br/>ffffff000416dde0 genunix:watch_copyin+1d ()<br/>ffffff000416de50 sockfs:copyin_name+91 ()<br/>ffffff000416deb0 sockfs:bind+90 ()<br/>ffffff000416df00 unix:brand_sys_syscall32+328 ()</pre><p>The bug is actually a regression caused by CR 6292199 (<i>bcopy and kcopy should'nt use rep, smov</i>) and<br/>was fixed by an engineer from Intel in OpenSolaris/Nevada code base.</p><p>This is instance of an event which I like so much - unintended <b>positive</b> consequence elsewhere. In contrast with<br/>so called <a href="http://en.wikipedia.org/wiki/Collateral_damage">collateral damage</a> this is something<br/>which is beneficial in other areas. I've written nc test suite to test primarily nc(1) command but here it proved<br/>to be useful for testing other areas of the system as well. In this case it was thanks to the fact that the<br/>test suite is run with memory leak checking by default (see <tt>NC_PRELOADS</tt> variable in <br/><a href="http://src.opensolaris.org/source/xref/test/ontest-stc2/src/suites/net/nc/include/vars">src/suites/net/nc/include/vars</a> file).</p><p>And yes, CR 6793191 is fixed by now.</p>
</body></html>
